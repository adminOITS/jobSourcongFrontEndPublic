<div class="space-y-6">
  <!-- Header with Limit Control -->
  <div
    class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"
  >
    <div class="flex items-center justify-between gap-2">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
        {{ "ATS_MATCHED_PROFILES" | translate }}
      </h3>
    </div>

    <div class="flex flex-row gap-2 sm:items-center sm:justify-end">
      <button
        pButton
        type="button"
        (click)="reAnalyze()"
        [disabled]="isPublishing()"
        [label]="
          !isPublishing()
            ? ('REANALYZE_CANDIDATES' | translate)
            : ('PUBLISHING' | translate)
        "
        [icon]="'pi pi-refresh'"
        class="bg-gradient-to-r! w-full! sm:w-fit! rounded-md! from-secondary! to-primary! text-white! shadow-md! border-none! transition-colors duration-150 hover:opacity-90!"
      ></button>

      <!-- Limit Selector -->
      <div class="flex items-center gap-2">
        <label class="text-sm lg:text-base text-gray-600 dark:text-gray-400"
          >{{ "SHOW" | translate }}:</label
        >
        <p-select
          [options]="limitOptions"
          [ngModel]="currentLimit()"
          optionLabel="name"
          optionValue="value"
          class="w-fit! rounded-md! bg-card! text-text! hover:border-primary! focus:border-primary! focus:ring-primary! dark:hover:border-white! dark:focus:border-white! dark:focus:ring-white!"
          (onChange)="onLimitChange($event.value)"
        ></p-select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div
    *ngIf="isLoading() && profiles()?.data?.length === 0"
    class="text-center py-12"
  >
    <div
      class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"
    ></div>
    <p class="text-gray-600 dark:text-gray-400">
      {{ "LOADING_ATS_PROFILES" | translate }}
    </p>
  </div>

  <!-- No Profiles State -->
  <div
    *ngIf="
      !isLoading() && (!profiles()?.data || profiles()?.data?.length === 0)
    "
    class="text-center py-12"
  >
    <div
      class="w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4"
    >
      <i class="pi pi-users text-2xl text-gray-400"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
      {{ "NO_ATS_PROFILES_FOUND" | translate }}
    </h3>
    <p class="text-gray-600 dark:text-gray-400">
      {{ "NO_CANDIDATE_PROFILES_MATCH" | translate }}
    </p>
  </div>

  <!-- Profiles Grid -->
  <div
    *ngIf="profiles()?.data && profiles().data.length > 0"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
  >
    <div
      *ngFor="let profile of profiles()?.data; trackBy: trackByProfileId"
      class="profile-card bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 relative"
    >
      <!-- Score Badge -->
      <div class="score-badge">
        <p-tag
          *ngIf="profile.score"
          [value]="profile.score + '%'"
          class="text-xs font-semibold"
          [severity]="getSeverity(profile.score)"
        ></p-tag>
      </div>

      <!-- Profile Header -->
      <div class="mb-4">
        <h4 class="font-semibold text-gray-900 dark:text-white text-lg mb-1">
          <ng-container
            *ngIf="
              profile.candidate.firstName || profile.candidate.lastName;
              else unknownCandidate
            "
          >
            {{ profile.candidate.firstName || "" }}
            {{ profile.candidate.lastName || "" }}
          </ng-container>
          <ng-template #unknownCandidate>
            {{ "UNKNOWN_CANDIDATE" | translate }}
          </ng-template>
        </h4>
        <p class="text-gray-600 dark:text-gray-400 text-sm">
          {{ profile.profileTitle || ("NO_TITLE" | translate) }}
        </p>
      </div>

      <!-- Score Progress Bar -->
      <div class="mb-4">
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{
            "MATCH_SCORE" | translate
          }}</span>
          <span class="text-sm text-gray-600 dark:text-gray-400"
            >{{ profile.score }}%</span
          >
        </div>
        <p-progressBar
          *ngIf="profile.score"
          [value]="profile.score"
          [styleClass]="'h-2'"
          [style]="{ '--value-background': getScoreBgColor(profile.score) }"
        ></p-progressBar>
      </div>

      <!-- Profile Actions -->
      <div
        class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700"
      >
        <div class="text-xs text-gray-500 dark:text-gray-400">
          ID:
          {{
            profile.id
              ? profile.id.substring(0, 8)
              : ("NOT_AVAILABLE" | translate)
          }}...
        </div>
        <div class="flex items-center gap-2">
          <button
            class="px-3 py-1 text-xs bg-green-600 hover:bg-green-700 cursor-pointer text-white rounded-md transition-colors duration-200"
            (click)="applyToOffer(profile)"
          >
            {{ "APPLY" | translate }}
          </button>
          <button
            class="px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 cursor-pointer text-white rounded-md transition-colors duration-200"
            (click)="viewProfileDetails(profile)"
          >
            {{ "VIEW_DETAILS" | translate }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination Controls -->
  <div
    *ngIf="profiles()?.data && profiles().data.length > 0"
    class="flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700"
  >
    <div class="text-sm text-gray-600 dark:text-gray-400">
      {{ "SHOWING_PROFILES" | translate : { count: profiles().data.length } }}
    </div>

    <div class="flex items-center gap-2">
      <!-- Previous Button (disabled if no previous) -->
      <button
        [disabled]="!hasNext() || isLoading()"
        class="px-4 py-2 text-sm font-medium text-gray-500 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
      >
        <i class="pi pi-chevron-left mr-1"></i>
        {{ "PREVIOUS" | translate }}
      </button>

      <!-- Load More Button -->
      <button
        *ngIf="hasNext()"
        (click)="loadMore()"
        [disabled]="isLoading()"
        class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 border border-transparent rounded-md disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
      >
        <span *ngIf="!isLoading()">{{ "LOAD_MORE" | translate }}</span>
        <span *ngIf="isLoading()" class="flex items-center gap-2">
          <div
            class="animate-spin rounded-full h-4 w-4 border-b-2 border-white"
          ></div>
          {{ "LOADING_ATS_PROFILES" | translate }}
        </span>
      </button>

      <!-- Next Button (disabled if no next) -->
      <button
        [disabled]="!hasNext() || isLoading()"
        class="px-4 py-2 text-sm font-medium text-gray-500 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"
      >
        {{ "NEXT" | translate }}
        <i class="pi pi-chevron-right ml-1"></i>
      </button>
    </div>
  </div>

  <!-- Apply to Offer Dialog -->
  <app-apply-to-offer-dialog
    [isVisible]="isApplyDialogVisible"
    [candidateId]="applyDialogCandidateId()"
    [profileId]="applyDialogProfileId()"
    (visibleChange)="onDialogVisibleChange($event)"
    (applyWithEmail)="onApplyWithEmail($event)"
    (applyWithoutEmail)="onApplyWithoutEmail($event)"
  ></app-apply-to-offer-dialog>
</div>
